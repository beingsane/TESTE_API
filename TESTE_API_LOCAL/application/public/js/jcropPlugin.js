var aspectRatioVar	= 0;var alturaVar		= 0;var larguraVar		= 0;var namesFiles		= new Array();var namesHidden		= '';var openCrop		= false;var jcrop_target	= '';var cropOk			= false;var baseURLJcop		= $("#HTTP_BASEPATH").val();function saveDataHiden(){	var target = $("#jcrop_target");	if (target != null && (target.attr("src") == "" || target.attr("src") == null || target.attr("src") == undefined)) {		return;	}	if(namesHidden==''){		alert("Erro na busca do tipo de crop");		return false;	}	if(cropOk==false){		alert("Selecione as posições na imagem abaixo");		return false;	}	///// escreve a imagem no div	$("#"+jcrop_target).html(			'<div class="cropImageId" style="width:'+larguraVar+'px;height:'+alturaVar+'px;border-radius:10px;border:none">'+			'   <img id="image'+namesHidden+'" src="'+$("#preview").attr("src")+'" style="'+$("#preview").attr("style")+'" alt=""/>'+			'</div>'	);	
	$('#coordsX-'+namesHidden).attr("value",namesFiles['coordsX-'+namesHidden]);	$('#coordsY-'+namesHidden).attr("value",namesFiles['coordsY-'+namesHidden]);	$('#coordsX2-'+namesHidden).attr("value",namesFiles['coordsX2-'+namesHidden]);	$('#coordsY2-'+namesHidden).attr("value",namesFiles['coordsY2-'+namesHidden]);	$('#coordsW-'+namesHidden).attr("value",namesFiles['coordsW-'+namesHidden]);	$('#coordsH-'+namesHidden).attr("value",namesFiles['coordsH-'+namesHidden]);
	if(namesFiles['nameImageCrop-'+namesHidden]==null || namesFiles['nameImageCrop-'+namesHidden]=="") {		nameImageCrop = $("#jcrop_target").attr("src").split("/")[3];	}else{		nameImageCrop = namesFiles['nameImageCrop-'+namesHidden];	}	$('#nameImageCrop-'+namesHidden).attr("value",nameImageCrop);		/////Limpa a imagem Preview e o campo de crop	$('#preview').attr({"src":"","style":"display:none"});	$('#files').html('<img id="jcrop_target" alt="" style="display:none" src=""/>');	
	openCrop	= false;	cropOk		= false	$("#"+jcrop_target).css("background","none")	$('#maskOpenImgCrop').hide();	$('.crop').hide();}

function crop(target,preview,fields,nameImage){	$(function(){		$('#'+target).Jcrop({			onChange: showPreview,			onSelect: showPreview,			onRelease: hidePreview,			aspectRatio: aspectRatioVar		});	  var $preview = $('#'+preview);	  // Our simple event handler, called from onChange and onSelect	  // event handlers, as per the Jcrop invocation above	  function showPreview(coords){		xHeight = Math.round(document.getElementById(target).height);		yWidth  = Math.round(document.getElementById(target).width);		if (parseInt(coords.w) > 0){			cropOk=true;			var rx = larguraVar / coords.w;			var ry = alturaVar / coords.h;			namesFiles['coordsX-'+fields]		= coords.x;			namesFiles['coordsY-'+fields]		= coords.y;			namesFiles['coordsX2-'+fields]		= coords.x2;			namesFiles['coordsY2-'+fields]		= coords.y2;			namesFiles['coordsW-'+fields]		= coords.w;			namesFiles['coordsH-'+fields]		= coords.h;			namesFiles['nameImageCrop-'+fields]	= nameImage;
			$preview.css({				width: Math.round(rx *  yWidth ) + 'px',				height: Math.round(ry * xHeight ) + 'px',				marginLeft: '-' + Math.round(rx * coords.x) + 'px',				marginTop: '-' + Math.round(ry * coords.y) + 'px'			}).show();		}	  }
	  function hidePreview(){		$preview.stop().fadeOut('fast');	  }	});}

function uploadImg(){	/////Cria os campos com as cordenadas e o nome da imagem	if($('#coordsX-'+namesHidden).val()==undefined){		$('#divHidenField').append('<input type="hidden" name="coordsX-'+namesHidden+'" id="coordsX-'+namesHidden+'" value=""/>'+						  '<input type="hidden" name="coordsY-'+namesHidden+'" id="coordsY-'+namesHidden+'" value=""/>'+						  '<input type="hidden" name="coordsX2-'+namesHidden+'" id="coordsX2-'+namesHidden+'" value=""/>'+						  '<input type="hidden" name="coordsY2-'+namesHidden+'" id="coordsY2-'+namesHidden+'" value=""/>'+						  '<input type="hidden" name="coordsW-'+namesHidden+'" id="coordsW-'+namesHidden+'" value=""/>'+						  '<input type="hidden" name="coordsH-'+namesHidden+'" id="coordsH-'+namesHidden+'" value=""/>'+						  '<input type="hidden" name="nameImageCrop-'+namesHidden+'" id="nameImageCrop-'+namesHidden+'" value=""/>');	}
	
$(function(){		var btnUpload	=$('#upload');		//////BotÃ£o que farÃ¡ o upload		var status		=$('#status');		//////Div que contÃ©m o status do upload		var files		=$('#files');		//////Div que contÃ©m o Arquivo recebido do post		var jcrop_target="jcrop_target";	//////Imagem que estÃ¡ dentro da div #files		var cropImage	=$('#cropImage');	//////Div que contÃ©m o preview		var preview		="preview";			//////Preview do crop		var typeSubmit	=namesHidden;		//////Sufixo dos Campos		var nowDate			= new Date();		var currentMilis	= nowDate.getTime();		new AjaxUpload(btnUpload, {			// Arquivo que farÃ¡ o upload			//action: "/teste/frontend/index.php/upload_image",			action	: baseURLJcop+"/backend/upload_mig_file_json",			//Nome da caixa de entrada do arquivo			name	: 'arquivo',			data	: {acao:"0",id:"tmp",nome:""+currentMilis+"-"+Math.floor(Math.random()*1000000)},			onSubmit: function(file, ext){				 if (! (ext && /^(jpg|jpeg|png|x-png)$/.test(ext))){ 					// verificar a extensÃ£o de arquivo vÃ¡lido					status.text('Somente imagens JPG e PNG são permitidas');					return false;				}				files.html('');				cropImage.html('');				/////Mostra a barra de status			},			onComplete: function(file, response){				resposta=JSON.parse(response);				//Adicionar arquivo carregado na lista				var dTmp			= new Date();				var imgRand			= "?dummyTS="+dTmp.getTime();				if(resposta.errorCode=="0"){					var style= "style=\"width:\""+larguraVar+";height:"+alturaVar+"px";					files.html('<img id="'+jcrop_target+'" src="'+resposta.data+imgRand+'" alt=""/>').addClass('success');					cropImage.html('<img id="'+preview+'" src="'+resposta.data+imgRand+'" alt="" '+style+'/>');				} else{					status.html('<b style="color:red">'+resposta.errorDesc+'</b>');					files.text(file).addClass('error');				}				crop(jcrop_target,preview,namesHidden,resposta.data);			}		});	});}